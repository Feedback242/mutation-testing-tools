#!/usr/bin/env bash
################################################################################
#
# This script tests the D4J's mutation analysis script.
#
################################################################################
# by extracting the mutation analysis workflow into a parameterized function.

HERE=$(cd `dirname $0` && pwd)

# Import helper subroutines and variables, and init Defects4J
source "$HERE/test.include" || exit 1
init

export PATH=$PATH:~/IdeaProjects/defects4j/framework/bin




################################################################################
#
# Set variables used by the test script, based on provided PID and VID
#
_set_vars() {
    # Set PID, VID, and the temporary directory
       pid="$1"
       vid="$2"
       pid_vid_dir="$TMP_DIR/$pid/$pid-$vid"

       # Files generated by Major
       summary_file="$pid_vid_dir/summary.csv"
       mutants_file="$pid_vid_dir/mutants.log"
       kill_file="$pid_vid_dir/kill.csv"
	echo $pid_vid_dir


	# Checkout project-version
	defects4j checkout -p "$pid" -v "$vid" -w "$pid_vid_dir" || die "It was not possible to checkout $pid-$vid to '$pid_vid_dir'!"
	defects4j compile  -w "$pid_vid_dir" || die "It was not possible to compile $pid-$vid to '$pid_vid_dir'!"
##
	defects4j test -w "$pid_vid_dir" || die "It was not possible to test $pid-$vid to '$pid_vid_dir'!"
	defects4j export -p classes.modified -o $pid_vid_dir/classes_modified  -w $pid_vid_dir
	defects4j export -p classes.relevant -o $pid_vid_dir/classes_relevant  -w $pid_vid_dir
	defects4j export -p tests.trigger -o $pid_vid_dir/test_trigger  -w $pid_vid_dir
	defects4j export -p tests.relevant -o $pid_vid_dir/test_relevant  -w $pid_vid_dir

  cat $pid_vid_dir/classes_modified | tr '\n' ',' > $pid_vid_dir/mod_classes
  cat $pid_vid_dir/test_relevant | tr '\n' ',' > $pid_vid_dir/relevant_tests



}
checkoutandcompile(){
	subject=$1
  shift

	for i in  $@
		do
		echo $subject $i
			#_set_vars $subject $i"b"
			_set_vars $subject $i"f"

		done;
}


#checkoutandcompile Chart 2 5 6 8 11 16 18 22 24
#checkoutandcompile Closure
checkoutandcompile Lang 5 7 11 12 16 24
#checkoutandcompile Math 4 6 22 27 31 102 105
#checkoutandcompile Mockito
#checkoutandcompile Time 1 2 5 8 9 12 15 17 27
#checkoutandcompile Codec
#checkoutandcompile Compress
#checkoutandcompile Csv
#checkoutandcompison Gson
#checkoutandcompile JacksonCore
#checkoutandcompile JacksonDatabind
#checkoutandcompile Jsoup
#checkoutandcompile JxPath
#checkoutandcompile Cli
#checkoutandcompile Collections
#checkoutandcompile JacksonXml